-- Создание таблицы оферт с поддержкой 11 разделов
CREATE TABLE IF NOT EXISTS offers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    version VARCHAR(50) NOT NULL,
    is_active BOOLEAN DEFAULT FALSE,
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Индексы для оптимизации
CREATE INDEX IF NOT EXISTS idx_offers_active ON offers(is_active);
CREATE INDEX IF NOT EXISTS idx_offers_created_at ON offers(created_at);
CREATE INDEX IF NOT EXISTS idx_offers_version ON offers(version);

-- Комментарии к таблице
COMMENT ON TABLE offers IS 'Таблица оферт для мастер-классов восковых ручек';
COMMENT ON COLUMN offers.title IS 'Название оферты';
COMMENT ON COLUMN offers.content IS 'Содержимое оферты в HTML формате с 11 разделами';
COMMENT ON COLUMN offers.version IS 'Версия оферты (например, 1.0, 1.1)';
COMMENT ON COLUMN offers.is_active IS 'Активна ли данная версия оферты';
COMMENT ON COLUMN offers.created_by IS 'ID пользователя, создавшего оферту';

-- Вставка начальной оферты
INSERT INTO offers (title, content, version, is_active, created_by) VALUES (
    'Оферта на проведение мастер-классов восковых ручек',
    '<div class="offer-content">
        <h1>Оферта на проведение мастер-классов восковых ручек</h1>
        
        <h2>1. Общие положения</h2>
        <p>Настоящая оферта определяет условия проведения мастер-классов по изготовлению восковых ручек (далее - мастер-классы).</p>
        
        <h2>2. Предмет договора</h2>
        <p>Исполнитель обязуется провести мастер-класс по изготовлению восковых ручек, а Заказчик обязуется оплатить услуги в размере и порядке, установленном настоящей офертой.</p>
        
        <h2>3. Права и обязанности сторон</h2>
        <h3>3.1. Права и обязанности Исполнителя:</h3>
        <ul>
            <li>Провести мастер-класс в соответствии с заявленной программой</li>
            <li>Предоставить все необходимые материалы и инструменты</li>
            <li>Обеспечить безопасность участников во время проведения мастер-класса</li>
        </ul>
        
        <h3>3.2. Права и обязанности Заказчика:</h3>
        <ul>
            <li>Своевременно оплатить услуги в соответствии с условиями оферты</li>
            <li>Соблюдать правила поведения во время мастер-класса</li>
            <li>Уведомить о невозможности участия не менее чем за 24 часа</li>
        </ul>
        
        <h2>4. Стоимость и порядок расчетов</h2>
        <p>Стоимость мастер-класса указана на сайте waxhands.ru</p>
        <p>Оплата производится в полном размере до начала мастер-класса.</p>
        
        <h2>5. Ответственность сторон</h2>
        <p>Стороны несут ответственность в соответствии с действующим законодательством РФ.</p>
        
        <h2>6. Конфиденциальность и защита данных</h2>
        <p>Стороны обязуются соблюдать конфиденциальность персональных данных в соответствии с ФЗ-152 "О персональных данных".</p>
        
        <h2>7. Форс-мажор</h2>
        <p>Стороны освобождаются от ответственности за неисполнение обязательств, если это вызвано обстоятельствами непреодолимой силы.</p>
        
        <h2>8. Разрешение споров</h2>
        <p>Все споры решаются путем переговоров, а при невозможности достижения соглашения - в судебном порядке.</p>
        
        <h2>9. Порядок изменения оферты</h2>
        <p>Исполнитель вправе в одностороннем порядке изменять условия настоящей оферты с уведомлением Заказчика.</p>
        
        <h2>10. Заключительные положения</h2>
        <p>Настоящая оферта вступает в силу с момента акцепта Заказчиком и действует до полного исполнения обязательств сторонами.</p>
        
        <h2>11. Реквизиты исполнителя</h2>
        <p><strong>ИП:</strong> [ФИО индивидуального предпринимателя]</p>
        <p><strong>ИНН:</strong> 272210695289</p>
        <p><strong>Телефон:</strong> 8914-545-06-06</p>
        <p><strong>Email:</strong> pavelt80@mail.ru</p>
    </div>',
    '1.0',
    TRUE,
    (SELECT id FROM users WHERE role = 'admin' LIMIT 1)
) ON CONFLICT DO NOTHING;
