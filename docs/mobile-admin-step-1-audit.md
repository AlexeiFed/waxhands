# Мобильная админ-панель — Шаг 1. Аудит текущего UI

> Цель: зафиксировать текущее состояние критичных экранов админ-панели, выделить сценарии и узкие места, чтобы при адаптации не нарушить существующий функционал.

## 0. Навигация и оболочка
- **Компонент:** `src/pages/admin/Dashboard.tsx`
- **Текущее состояние:** табовая навигация (`TabsList/TabsTrigger`) вдоль горизонтали, фиксированная шапка отсутствует. Левая колонка занята фильтрами/статистикой, правая — таблицами.
- **Ключевые зависимости:** `AdminFiltersContext`, React Query кеши (`useUsers`, `useSchools`, `useMasterClasses`, `useInvoices`, `useAdminChat`).
- **Риски для mobile:** табы переносятся на две строки, фильтры и таблицы требуют ширины > 1024 px, модалки центрируются на 70% ширины экрана.

## 1. Пользователи (`value="users"`)
- **Лэйаут:**
  - Верхняя панель: поиск (`Input`), фильтры `Select` (роль, школа, класс), кнопка сброса.
  - Контент: `Table` с колонками (ФИО, роль, контакт, школа, класс, действия).
  - Дополнительные UI: раскрывающиеся строки для детей (`ChevronDown`), модалки `AddUserModal`, `AlertDialog` для удаления.
- **Сценарии:** поиск, фильтрация, просмотр детей, добавление/удаление пользователей.
- **Проблемы на mobile:** горизонтальный скролл, иконки в таблице слишком близко, фильтры занимают всю ширину, раскрытие дочерних строк требует точного клика.

## 2. Школы (`value="schools"`)
- **Лэйаут:**
  - Search + кнопка «Добавить школу».
  - `SchoolFilters` (многоступенчатый фильтр) в виде горизонтального блока.
  - Таблица с 7 колонками, каждое действие — кнопка + `AlertDialog`.
- **Сценарии:** поиск, фильтр по городу/адресу, добавление/редактирование школы (`SchoolModal`), удаление.
- **Проблемы на mobile:** таблица не помещается, фильтры занимают ширину, модалка имеет фиксированную ширину 720px.

## 3. Мастер-классы — список (`<MasterClassesTab />`)
- **Компонент:** `src/components/admin/MasterClassesTab.tsx`.
- **Лэйаут:** много карточек и таблиц (статистика, фильтры, список мастер-классов). Управление оплатой (`usePaymentSettings`), экспорт XLSX, переключатели состояний.
- **Сценарии:** фильтрация по услуге/школе/дате, добавление/редактирование мастер-класса (формы с календарем), включение Robokassa, экспорт.
- **Проблемы:** сложная сетка с `grid-cols-2`, таблицы внутри карточек, календари занимают ширину > 600px, множества action-buttons в строке.

## 4. Мастер-класс — детальная (`<MasterClassDetails />`)
- **Файл:** `src/components/admin/MasterClassDetails.tsx`.
- **Содержимое:** модальное окно с табами (участники, счета, заметки, материалы), таблицы участников и платежей, секция оплаты.
- **Сценарии:** просмотр состава, управление примечаниями, запуск Robokassa, возвраты.
- **Проблемы:** модалка фиксированной ширины ~960px, внутренняя сетка использует `grid-cols-2`, таблицы без обтекания, кнопки действия расположены горизонтально.

## 5. Счета (`<InvoicesTab />`)
- **Компонент:** `src/components/admin/InvoicesTab.tsx`.
- **Лэйаут:** два столбца (фильтры + список счетов). Список реализован `Table`/`Accordion` гибридом, карточки с деталями платежей.
- **Сценарии:** фильтрация по статусу, датам, экспорты, просмотр конкретного счета, триггеры на Robokassa.
- **Проблемы:** большое количество колонок, дублированная информация в одной строке, верхние фильтры упираются в ширину.

## 6. Заявки на мастер-классы (`<WorkshopRequestsTab />`)
- **Файл:** `src/components/admin/WorkshopRequestsTab.tsx`.
- **Лэйаут:** табы «Новые / В обработке / Завершено», таблица заявок, карточки с подробностями, модалки редактирования.
- **Сценарии:** просмотр заявки, смена статуса, назначение исполнителей, экспорт XLSX.
- **Проблемы:** табы + таблица на одной ширине, много кнопок, timeline-вставки, модалки ~800px.

## 7. Чат (`useAdminChat` + `Chat` компоненты в Dashboard)
- **Лэйаут:** правый сайдбар (лист диалогов) + основная область сообщений. Используются `Sheet` и `Dialog` для вложений.
- **Сценарии:** выбор пользователя, просмотр истории, ответы, загрузка файлов, real-time обновление через WebSocket.
- **Проблемы:** двухколоночный макет, всплывающий чат занимает 60% ширины, поля ввода/список сообщений не адаптированы под маленькую высоту.

## 8. Зависимости и данные
- **API:** `useUsers`, `useSchools`, `useMasterClasses`, `useInvoices`, `useAdminChat`, `api.paymentSettings` — их структуры должны сохраниться.
- **WebSocket:** для мастер-классов, заявок, чата. При адаптации нужно сохранять подписки и перерисовки.
- **Модалки:** `Dialog`, `Sheet`, `AlertDialog` используют фиксированные ширины/позиционирование — требуется mobile-friendly вариант.

## 9. Основные pain-points для адаптации
1. **Табличные данные** на 6–8 колонок → требуется карточный режим + collapsible детали.
2. **Многоуровневые фильтры** занимают ширину; нужен перенос в Drawer/Bottom Sheet.
3. **Модальные окна** с фиксированной шириной (>700px) — нужно переходить на полноэкранные модалки/листовые bottom sheets.
4. **Таб-навигация** ломается при ширине < 640px — требуется гамбургер/Drawer.
5. **Множественные действия** (кнопки, экспорт, чекбоксы) — нужно переработать в всплывающие панели/меню.

## 10. Выводы по шагу 1
- Все обязательные разделы используют компоненты из `Dashboard.tsx` + специализированные вкладки (`MasterClassesTab`, `InvoicesTab`, `WorkshopRequestsTab`, `MasterClassDetails`).
- Функционал сильно опирается на таблицы и модалки; основной объем работы — преобразовать таблицы в карточки, фильтры в off-canvas/Bottom Sheet, а модалки — в адаптивные контейнеры.
- Следующий шаг: проектирование навигации (гамбургер + нижнее меню) и дизайн-паттернов карточного представления для списков.
