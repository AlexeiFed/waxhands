# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ Robokassa

## üìã –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —á–µ–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é –º–µ–∂–¥—É –¥–∞–Ω–Ω—ã–º–∏ —á–µ–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä:
1. **–ù–∞–∑–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π** - –≤ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –ø—Ä–µ—Ñ–∏–∫—Å—ã "–í—ã–±—Ä–∞–Ω–Ω–∞—è —Ä—É—á–∫–∞:" –∏ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞:"
2. **PaymentObject** - –≤ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `service` –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞** - –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —á–µ–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è JWT API –≤–æ–∑–≤—Ä–∞—Ç–∞:
- **–ù–∞–∑–≤–∞–Ω–∏—è** –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —á–µ–∫—É
- **PaymentObject** –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–∏–ø—É –ø–æ–∑–∏—Ü–∏–∏
- **PaymentMethod** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `full_payment`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞** –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π (–±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤)

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π
**–ë—ã–ª–æ:**
```typescript
Name: `–í—ã–±—Ä–∞–Ω–Ω–∞—è —Ä—É—á–∫–∞: ${style.name}`,
Name: `–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞: ${option.name}`,
```

**–°—Ç–∞–ª–æ:**
```typescript
Name: style.name, // –ë–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
Name: option.name, // –ë–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã PaymentObject
**–ë—ã–ª–æ:**
```typescript
PaymentObject: 'service' // –î–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
```

**–°—Ç–∞–ª–æ:**
```typescript
PaymentObject: 'job' // –î–ª—è —Å—Ç–∏–ª–µ–π (–º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã)
PaymentObject: 'service' // –î–ª—è –æ–ø—Ü–∏–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏)
```

### 3. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —á–µ–∫–∞
–¢–µ–ø–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —á–µ–∫–∞:

**–ß–µ–∫ (–æ–ø–ª–∞—Ç–∞):**
```json
{
  "sno": "osn",
  "items": [
    {
      "name": "–û–±—ã—á–Ω–∞—è —Ä—É—á–∫–∞",
      "quantity": 1,
      "sum": 400.00,
      "cost": 400.00,
      "payment_method": "full_payment",
      "payment_object": "job",
      "tax": "none"
    }
  ]
}
```

**–í–æ–∑–≤—Ä–∞—Ç (JWT API):**
```json
{
  "OpKey": "0005F891-8CCD-434B-8455-816AFFFDBF37-0VOisWikFF",
  "RefundSum": 400.0,
  "InvoiceItems": [
    {
      "Name": "–û–±—ã—á–Ω–∞—è —Ä—É—á–∫–∞",
      "Quantity": 1,
      "Cost": 400.0,
      "Tax": "none",
      "PaymentMethod": "full_payment",
      "PaymentObject": "job"
    }
  ]
}
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `backend/src/services/robokassaService.ts` - –º–µ—Ç–æ–¥ `getInvoiceItemsForRefund()`

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **–£–±—Ä–∞–Ω—ã –ø—Ä–µ—Ñ–∏–∫—Å—ã** –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö –ø–æ–∑–∏—Ü–∏–π
2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ PaymentObject**:
   - `job` –¥–ª—è —Å—Ç–∏–ª–µ–π (–º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã)
   - `service` –¥–ª—è –æ–ø—Ü–∏–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏)
3. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ nomenclature_code** –≤ —Ç–∏–ø–∞—Ö
4. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ JWT API** - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π JSON –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:
- **–¶–µ–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞** = —Å—É–º–º–∞ –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- **–ü–æ–∑–∏—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞** = —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ –æ–ø—Ü–∏–∏
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —á–µ–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞** = 100%

## üìã –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Robokassa

### JWT API –≤–æ–∑–≤—Ä–∞—Ç–∞:
- **–ú–µ—Ç–æ–¥**: POST `https://services.robokassa.ru/RefundService/Refund/Create`
- **–§–æ—Ä–º–∞—Ç**: JWT —Ç–æ–∫–µ–Ω –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
- **–ü–æ–¥–ø–∏—Å—å**: Password3 (HS256/HS384/HS512)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**: –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π JSON –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
- **OpKey** - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏
- **RefundSum** - —Å—É–º–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ (—á–∏—Å–ª–æ)
- **InvoiceItems** - –ø–æ–∑–∏—Ü–∏–∏ –∏–∑ —á–µ–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü–æ–ª—è InvoiceItems:
- **Name** - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞/—É—Å–ª—É–≥–∏
- **Quantity** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- **Cost** - —Ü–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
- **Tax** - –Ω–∞–ª–æ–≥–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞
- **PaymentMethod** - —Å–ø–æ—Å–æ–± —Ä–∞—Å—á–µ—Ç–∞
- **PaymentObject** - –ø—Ä–µ–¥–º–µ—Ç —Ä–∞—Å—á–µ—Ç–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:
1. **–°–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç** —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏ –∏ –æ–ø—Ü–∏—è–º–∏
2. **–û–ø–ª–∞—Ç–∏—Ç—å —Å—á–µ—Ç** - –ø–æ–ª—É—á–∏—Ç—å —á–µ–∫
3. **–ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
4. **–°—Ä–∞–≤–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** - —á–µ–∫ –∏ –≤–æ–∑–≤—Ä–∞—Ç –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –ù–∞–∑–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π —Å–æ–≤–ø–∞–¥–∞—é—Ç
- ‚úÖ PaymentObject —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É
- ‚úÖ –°—É–º–º—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç
- ‚úÖ JWT —Ç–æ–∫–µ–Ω —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-01-02  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** –ê–ª–µ–∫—Å–µ–π  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è




