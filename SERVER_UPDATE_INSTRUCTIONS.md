# Инструкции по обновлению сервера

## Проблемы, которые исправлены:

1. **Rate Limiting слишком строгий** - 100 запросов за 15 минут
2. **WebSocket соединения часто разрываются** - агрессивный heartbeat
3. **Админские эндпоинты блокируются** rate limiting

## Изменения в коде:

### 1. Rate Limiting (backend/src/index.ts)
- Увеличен лимит с 100 до 500 запросов за 15 минут
- Исключены админские эндпоинты из rate limiting:
  - `/api/chat/admin/*`
  - `/api/workshop-requests/stats/*`
  - `/api/health`

### 2. WebSocket Heartbeat (backend/src/websocket-server.ts)
- Увеличен таймаут с 60 сек до 5 минут
- Увеличена частота проверки с 30 сек до 60 сек
- Добавлен автоматический ping от сервера каждые 45 сек

## Команды для обновления на сервере:

```bash
# Подключиться к серверу
ssh root@147.45.161.83

# Перейти в папку бэкенда
cd /var/www/waxhands-app/backend

# Получить обновления
git pull origin main

# Установить зависимости (если нужно)
npm install

# Пересобрать проект
npm run build

# Перезапустить процесс
pm2 restart waxhands-backend

# Проверить статус
pm2 status
pm2 logs waxhands-backend
```

## Проверка после обновления:

1. **Rate Limiting**: попробовать загрузить админ-панель
2. **WebSocket**: проверить стабильность соединений
3. **Логи**: убедиться в отсутствии ошибок 429

## Переменные окружения (опционально):

Если нужно еще больше увеличить лимиты, можно изменить в `.env`:

```bash
RATE_LIMIT_MAX_REQUESTS=1000
RATE_LIMIT_WINDOW_MS=900000
```



