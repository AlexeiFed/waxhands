# üìä –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ FreekassaProvider

**–î–∞—Ç–∞:** 2024-10-16  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## üéØ –¶–µ–ª—å

–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é FreekassaProvider —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ FreeKassa API –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞
- –§–∞–π–ª: `src/pages/AboutNew.tsx`
- –£–±—Ä–∞–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä `maxLines` –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ `ExpandableText`

### 2. ‚úÖ –ò–∑—É—á–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è FreeKassa
- –§–∞–π–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: `docs/freekassa/–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Freekassa Api.html`
- –í—ã—è–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–¥–ø–∏—Å–∏ –∏ API endpoints

### 3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω FreekassaProvider
- –§–∞–π–ª: `backend/src/payments/providers/FreekassaProvider.ts`

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. **API Endpoints:**
   - ‚ùå –ë—ã–ª–æ: `https://api.freekassa.net/v1/`
   - ‚úÖ –°—Ç–∞–ª–æ: `https://api.fk.life/v1/`

2. **–ü–æ–¥–ø–∏—Å—å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Ñ–æ—Ä–º—ã (MD5):**
   - ‚ùå –ë—ã–ª–æ: `MD5(merchantId:amount:secretWord1:orderId)`
   - ‚úÖ –°—Ç–∞–ª–æ: `MD5(merchantId:amount:secretWord1:currency:orderId)`

3. **–ü–æ–¥–ø–∏—Å—å API –∑–∞–ø—Ä–æ—Å–æ–≤:**
   - ‚ùå –ë—ã–ª–æ: MD5 —Ö–µ—à
   - ‚úÖ –°—Ç–∞–ª–æ: HMAC-SHA256 —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º `|`

4. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: `currency` (–≤–∞–ª—é—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞)
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: `i` (–æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞)

5. **API –≤–æ–∑–≤—Ä–∞—Ç–æ–≤:**
   - ‚úÖ Endpoint: `https://api.fk.life/v1/orders/refund`
   - ‚úÖ –ü–æ–¥–ø–∏—Å—å: HMAC-SHA256

6. **–°—Ç–∞—Ç—É—Å –≤–æ–∑–≤—Ä–∞—Ç–∞:**
   - ‚úÖ Endpoint: `https://api.fk.life/v1/orders?order_id=...&signature=...`
   - ‚úÖ –ü–æ–¥–ø–∏—Å—å: HMAC-SHA256

### 4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –§–∞–π–ª—ã:
1. `docs/FREEKASSA_QUICK_SETUP.md`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å—è—Ö
   - –ü—Ä–∏–º–µ—Ä—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–µ–π
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL –¥–ª—è API

2. `docs/FREEKASSA_FIXES_REPORT.md`
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
   - –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–¥–ø–∏—Å–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
   - –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

3. `docs/PAYMENT_PROVIDERS_SETUP.md`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

4. `docs/changelog.md`
   - –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö FreekassaProvider

5. `docs/tasktracker.md`
   - –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º

## üîê –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–¥–ø–∏—Å–∏

### –ü–ª–∞—Ç–µ–∂–Ω–∞—è —Ñ–æ—Ä–º–∞ (MD5)
```typescript
const signature = crypto
  .createHash('md5')
  .update(`${merchantId}:${amount}:${secretWord1}:${currency}:${orderId}`)
  .digest('hex');
```

### Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (MD5)
```typescript
const signature = crypto
  .createHash('md5')
  .update(`${MERCHANT_ID}:${AMOUNT}:${secretWord2}:${MERCHANT_ORDER_ID}`)
  .digest('hex');
```

### API –∑–∞–ø—Ä–æ—Å—ã (HMAC-SHA256)
```typescript
const sortedKeys = Object.keys(data).sort();
const values = sortedKeys.map(key => String(data[key]));
const signatureString = values.join('|');
const signature = crypto
  .createHmac('sha256', apiKey)
  .update(signatureString)
  .digest('hex');
```

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend
- `backend/src/payments/providers/FreekassaProvider.ts`

### Frontend
- `src/pages/AboutNew.tsx`

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `docs/FREEKASSA_QUICK_SETUP.md`
- `docs/FREEKASSA_FIXES_REPORT.md`
- `docs/PAYMENT_PROVIDERS_SETUP.md`
- `docs/changelog.md`
- `docs/tasktracker.md`

### –°–∫—Ä–∏–ø—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- `deploy-freekassa-fixes.ps1`
- `FREEKASSA_DEPLOYMENT.md`
- `FREEKASSA_SUMMARY.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

## ‚úÖ –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ö–æ–¥ Robokassa –ù–ï –∏–∑–º–µ–Ω–∏–ª—Å—è** - –≤—Å–µ –ø—Ä–∞–≤–∫–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ FreekassaProvider
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Strategy Pattern** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
4. **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

## üöÄ –î–µ–ø–ª–æ–π

### –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±:
```powershell
.\deploy-freekassa-fixes.ps1
```

### –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
–°–º. `FREEKASSA_DEPLOYMENT.md`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç:
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ FreeKassa
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Ñ–æ—Ä–º—ã –≤ –ª–æ–≥–∞—Ö
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook –≤ –ª–æ–≥–∞—Ö
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —á–µ—Ä–µ–∑ API
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ FreekassaProvider –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ FreeKassa  
‚úÖ –í—Å–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–¥–ø–∏—Å–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  
‚úÖ API endpoints –æ–±–Ω–æ–≤–ª–µ–Ω—ã  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ API  
‚úÖ –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞  
‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ production

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/freekassa/–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Freekassa Api.html`
- **–û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö:** `docs/FREEKASSA_FIXES_REPORT.md`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ FreeKassa:** `docs/FREEKASSA_QUICK_SETUP.md`
- **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é:** `FREEKASSA_DEPLOYMENT.md`

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç—å `.\deploy-freekassa-fixes.ps1` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è production —Å–µ—Ä–≤–µ—Ä–∞

