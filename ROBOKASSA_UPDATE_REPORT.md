# ‚úÖ –û—Ç—á–µ—Ç –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –†–æ–±–æ–∫–∞—Å—Å–æ–π

**–î–∞—Ç–∞:** 20 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ê—Ä—Ö–∏–≤:** `backend-robokassa-fix-20250920-095202.zip`

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –ò–∑—É—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –†–æ–±–æ–∫–∞—Å—Å—ã
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –≤—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑ –ø–∞–ø–∫–∏ `docs/robokassa/`
- –ò–∑—É—á–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ 54-–§–ó
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —á–µ–∫–æ–≤

### ‚úÖ 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –†–æ–±–æ–∫–∞—Å—Å—ã (`robokassaService.ts`)
- **–í–∫–ª—é—á–µ–Ω–∞ —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è** - —Ç–µ–ø–µ—Ä—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–π —á–µ–∫
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã —Ç–æ–≤–∞—Ä–æ–≤** - –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞ `service` (—É—Å–ª—É–≥–∞) –∏ `none` (–±–µ–∑ –ù–î–°)
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ URL-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ Receipt –≤ –ø–æ–¥–ø–∏—Å–∏
- **–û–±–Ω–æ–≤–ª–µ–Ω—ã URL** - –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ API endpoints –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è Shp_ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### ‚úÖ 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (`robokassaController.ts`)
- –£–±—Ä–∞–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –°–∞—Ñ–æ–Ω–æ–≤–∞
- –û–ø–ª–∞—Ç–∞ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### ‚úÖ 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`RobokassaPayment.tsx`)
- –£–±—Ä–∞–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –°–∞—Ñ–æ–Ω–æ–≤–∞
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–∏–Ω—Ç–µ—Ä–∞
- –û–ø–ª–∞—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

### ‚úÖ 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test-robokassa-integration.js`
- –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–¥–ø–∏—Å–∏ –∏ —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ê—Ä—Ö–∏–≤ –∑–∞–≥—Ä—É–∂–µ–Ω: `/tmp/backend-robokassa-fix-20250920-095202.zip`
- Backend –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- PM2 –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
- WebSocket —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω `docs/changelog.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è `update-server.ps1`

## üîß –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è
```javascript
// –ë—ã–ª–æ: –ë–ï–ó —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–∏
// –°—Ç–∞–ª–æ: –° –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π
const receipt = {
    sno: 'osn',
    items: [{
        name: `–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å ${data.masterClassName}`,
        quantity: 1,
        sum: data.amount,
        payment_method: "full_prepayment", // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞
        payment_object: "service",         // –£—Å–ª—É–≥–∞
        tax: "none"                        // –ë–µ–∑ –ù–î–°
    }]
};
```

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
```javascript
// –ë—ã–ª–æ: MerchantLogin:OutSum:InvId:–ü–∞—Ä–æ–ª—å#1
// –°—Ç–∞–ª–æ: MerchantLogin:OutSum:InvId:Receipt:–ü–∞—Ä–æ–ª—å#1 (—Å —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π)
const encodedReceipt = encodeURIComponent(receipt);
const signatureString = `${merchantLogin}:${outSum}:${invId}:${encodedReceipt}:${password1}`;
```

### –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø–ª–∞—Ç—ã
```javascript
// –ë—ã–ª–æ: –¢–æ–ª—å–∫–æ –¥–ª—è –°–∞—Ñ–æ–Ω–æ–≤–∞
isPaymentAvailableForUser(userData) {
    return userData.surname === '–°–∞—Ñ–æ–Ω–æ–≤' && userData.phone === '+79241002233';
}

// –°—Ç–∞–ª–æ: –î–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
isPaymentAvailableForUser(userData) {
    return true;
}
```

## üåê –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

### ‚úÖ Backend API
- **URL:** https://waxhands.ru/api/health
- **–°—Ç–∞—Ç—É—Å:** HTTP 200 ‚úÖ
- **–ü—Ä–æ—Ü–µ—Å—Å:** PM2 waxhands-backend (ID: 13) ‚úÖ

### ‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä
- **URL:** wss://waxhands.ru/ws
- **–°—Ç–∞—Ç—É—Å:** HTTP 426 (Upgrade Required) ‚úÖ
- **–ü—Ä–æ—Ü–µ—Å—Å:** Node.js (PID: 381389) ‚úÖ

### ‚úÖ Nginx
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–µ–Ω ‚úÖ
- **HTTPS:** –†–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- **–ü—Ä–æ–∫—Å–∏:** API –∏ WebSocket –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã ‚úÖ

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –†–æ–±–æ–∫–∞—Å—Å–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–æ–≤ —Å —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Ñ–æ—Ä–º
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –û–±—â–∞—è —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã
- ‚úÖ PM2 –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ssh root@147.45.161.83 "pm2 status"

# –õ–æ–≥–∏ backend
ssh root@147.45.161.83 "pm2 logs waxhands-backend --lines 50"

# –°—Ç–∞—Ç—É—Å WebSocket
ssh root@147.45.161.83 "netstat -tlnp | grep 3002"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl -I https://waxhands.ru/api/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket
curl -I -H "Connection: Upgrade" -H "Upgrade: websocket" https://waxhands.ru/ws
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –†–æ–±–æ–∫–∞—Å—Å–æ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

1. **–§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 54-–§–ó
2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã —Ç–æ–≤–∞—Ä–æ–≤** - —É—Å–ª—É–≥–∏ –±–µ–∑ –ù–î–°
3. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å—å** - —Å URL-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ–∫–∞
4. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö** - —É–±—Ä–∞–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
5. **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ–Ω–ª–∞–π–Ω

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ
