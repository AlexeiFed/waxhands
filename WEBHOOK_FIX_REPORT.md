# üéØ –û—Ç—á–µ—Ç –æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ webhook'–∞ –ÆMoney

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ò–°–ü–†–ê–í–õ–ï–ù–û

**–î–∞—Ç–∞**: 26 —è–Ω–≤–∞—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: –ê–ª–µ–∫—Å–µ–π  

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

Webhook –æ—Ç –ÆMoney –Ω–µ –ø–æ–ª—É—á–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- –¢–∞–π–º–∞—É—Ç–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –ÆMoney
- –ü–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–ª–∞—Ç–µ–∂–∞—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

---

## üöÄ –†–µ—à–µ–Ω–∏–µ

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ SHA1** —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ÆMoney
- **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `codepro`** –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- **–£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞** - –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç 200 OK, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### 2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π webhook**: `/api/payment-webhook-diagnostic/yumoney-diagnostic`
- **–¢–µ—Å—Ç–æ–≤—ã–π endpoint**: `/api/payment-webhook-diagnostic/yumoney-test`
- **–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç**: `test-webhook.js` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 3. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–í—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏** –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **–°—ã—Ä–æ–µ —Ç–µ–ª–æ** –∑–∞–ø—Ä–æ—Å–∞
- **–ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** –∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏** SHA1
- **–ê–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–∫** –ø–ª–∞—Ç–µ–∂–µ–π

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ SHA1
```
notification_type&operation_id&amount&currency&datetime&sender&codepro&notification_secret&label
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ codepro
- **`codepro=false`**: –ü–ª–∞—Ç–µ–∂ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚úÖ
- **`codepro=true`**: –ü–ª–∞—Ç–µ–∂ –∑–∞—â–∏—â–µ–Ω –∫–æ–¥–æ–º –ø—Ä–æ—Ç–µ–∫—Ü–∏–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ù–ï–í–û–ó–ú–û–ñ–ù–ê ‚ùå

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
Webhook ‚Üí –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç 200 OK ‚Üí –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
```

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### 1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
cd backend
node test-webhook.js
```

### 2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ webhook'–∞
```bash
curl -X POST http://localhost:3001/api/payment-webhook-diagnostic/yumoney-diagnostic \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "notification_type=p2p-incoming&operation_id=test123&amount=100&currency=643&datetime=2025-01-26T12:00:00Z&sender=41001123456789&codepro=false&label=INV-test-123&sha1_hash=test_hash"
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
tail -f /var/www/waxhands-app/backend/backend.log

# –õ–æ–∫–∞–ª—å–Ω–æ
tail -f backend.log
```

---

## üß™ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –¢–µ—Å—Ç 1: P2P –ø–µ—Ä–µ–≤–æ–¥ (codepro=false)
- ‚úÖ –î–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –°—Ç–∞—Ç—É—Å —Å—á–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ 'paid'
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –¢–µ—Å—Ç 2: –ü–ª–∞—Ç–µ–∂ –∫–∞—Ä—Ç–æ–π (codepro=false)
- ‚úÖ –î–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ú–µ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

### –¢–µ—Å—Ç 3: –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂ (codepro=true)
- ‚ö†Ô∏è –ù–ï –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚ÑπÔ∏è –î–æ–ª–∂–µ–Ω –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ —Ç—Ä–µ–±—É—é—â–∏–π —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ
1. **–ü–∞—Ä–∞–º–µ—Ç—Ä `codepro`** - –µ—Å–ª–∏ `true`, –ø–ª–∞—Ç–µ–∂ –ù–ï –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç 200 OK** - –ÆMoney –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥
3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ SHA1** - –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
1. **–õ–æ–≥–∏ webhook'–∞** - –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
2. **–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–æ–≤** - webhook –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç 200 OK
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –≤—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã

---

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ
1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏ –ÆMoney
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å–ª–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. **–°—Ä–∞–≤–Ω–∏—Ç—å** —Ç–µ—Å—Ç–æ–≤—ã–µ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –í –±—É–¥—É—â–µ–º
1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É** –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (codepro=true)
2. **–î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö
3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å** —Å API –ÆMoney –¥–ª—è accept-payment

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

Webhook –ÆMoney —Ç–µ–ø–µ—Ä—å:
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç** 200 OK –Ω–∞ –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç** –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç** –ø–æ–¥–ø–∏—Å–∏ SHA1
- ‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** –≤—Å–µ —Ç–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç** —Ç–∞–π–º–∞—É—Ç—ã –æ—Ç –ÆMoney

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏!** üöÄ
